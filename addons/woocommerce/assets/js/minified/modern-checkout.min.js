function slideInAndOutContent(e,s){const t=document.querySelector(e),i=document.querySelector(".ast-order-review-toggle-text");t&&t.addEventListener("click",function(e){const t=document.querySelector(s);var o=t.querySelector("*");if(t)if(e.currentTarget.classList.contains("active"))e.currentTarget.classList.remove("active"),t.style.maxHeight=0,i&&(i.textContent=astraAddon.order_review_toggle_texts.toggle_show_text);else if(o&&(e.currentTarget.classList.add("active"),t.style.maxHeight=o.clientHeight+"px",i)){i.textContent=astraAddon.order_review_toggle_texts.toggle_hide_text;const a=document.querySelector("#ast-order-review-content"),n=document.querySelector("#order_review");["change",'select.shipping_method, input[name^="shipping_method"]'].forEach(e=>a.addEventListener(e,function(){n.querySelectorAll('input[name^="shipping_method"][type="radio"]:checked').forEach(e=>{e.removeAttribute("checked")}),document.querySelector("body").dispatchEvent(new CustomEvent("update_checkout",{detail:{update_shipping_method:!0}}))}))}})}validateEmail=function(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)};let xhrCountEmail=0,delayTimerEmail;function validateInlineEmail(){const a=document.querySelector("#billing_email");if(a){const n=a.value;if(void 0===n||astraAddon.is_logged_in)return;const s=document.querySelector(".ast-create-account-section"),i=document.querySelector(".woocommerce-billing-fields__customer-login-label"),c=document.querySelector(".ast-email-validation-block"),r=document.querySelector("#ast-customer-login-url");if(""!==n){if(c&&c.remove(),!validateEmail(n))return a.insertAdjacentHTML("afterend",`<span class="ast-email-validation-block error"> ${astraAddon.email_validation_msgs.error_msg} </span>`),!1;clearTimeout(delayTimerEmail);const l=++xhrCountEmail;delayTimerEmail=setTimeout(async function(){let o=new XMLHttpRequest;o.open("POST",astra.ajax_url,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send("action=astra_woo_check_email_exist&email_address="+n+"&security="+astraAddon.check_email_exist_nonce),o.onload=function(){if(o.readyState==XMLHttpRequest.DONE&&(200<=o.status||400<=o.status)){document.cookie="ast_modern_checkout_useremail="+n;var e=JSON.parse(o.responseText);if(l===xhrCountEmail)if(c&&c.remove(),e.data.success&&r&&r.classList.contains("active"))a.insertAdjacentHTML("afterend",'<span class="ast-email-validation-block success">'+astraAddon.email_validation_msgs.success_msg+"</span>");else if(e.data.success)e.data.is_login_allowed&&(a.insertAdjacentHTML("afterend",'<span class="ast-email-validation-block success">'+astraAddon.email_validation_msgs.success_msg+"</span>"),r&&!r.classList.contains("active")&&r.click()),s&&(s.style.display="none"),i&&(i.style.display="block");else{if(r&&r.classList.contains("active")&&r.click(),s){const t=s.querySelector("create-account label.checkbox");t&&(t.style.display="block"),s.style.display="block"}i&&(i.style.display="none")}}}},300)}else r&&r.classList.contains("active")&&r.click(),c&&(c.style.display="none"),i&&(i.style.display="block"),s&&(s.style.display="none")}return!1}function woocommerceUserLogin(){const e=document.querySelector(".ast-customer-login-section__login-button");e&&e.addEventListener("click",function(){var e=document.querySelector("#billing_email"),t=document.querySelector("#billing_password");if(e||!t){let o=new XMLHttpRequest;o.open("POST",astra.ajax_url,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send("action=astra_woocommerce_login_user&email="+e.value+"&password="+t.value+"&security="+astraAddon.woocommerce_login_nonce),o.onload=function(){if(o.readyState==XMLHttpRequest.DONE&&(200<=o.status||400<=o.status)){var e=JSON.parse(o.responseText);if(e.data.success)location.reload();else{const t=document.querySelector(".ast-customer-info__notice");t&&(t.classList.add("active"),t.innerHTML=e.data.error)}}}}})}document.addEventListener("DOMContentLoaded",function(e){const t=document.querySelector("body");if(!astraAddon.cartflows_version&&t&&t.classList.contains("woocommerce-checkout")){const o=document.querySelector("#billing_email");o.addEventListener("input",validateInlineEmail),validateInlineEmail(),t&&!t.classList.contains("ast-woo-two-step-modern-checkout")&&slideInAndOutContent("#ast-order-review-toggle","#ast-order-review-content"),slideInAndOutContent("#ast-customer-login-url","#ast-customer-login-section"),woocommerceUserLogin()}});